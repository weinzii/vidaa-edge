<!-- Custom Code Modal Content -->
<div *ngIf="isOpen" class="space-y-4">
  <div>
    <div class="flex items-center justify-between mb-2">
      <div class="block text-sm font-semibold text-gray-300">
        JavaScript Code:
      </div>
    </div>
    <div class="relative">
      <button
        *ngIf="customJsCode.length > 200"
        (click)="onToggleCodeExpansion()"
        class="absolute top-2 right-2 text-gray-400 hover:text-orange-400 transition-colors p-1 bg-customGray-light rounded z-10"
        [title]="isCustomCodeExpanded ? 'Collapse editor' : 'Expand editor'"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            *ngIf="!isCustomCodeExpanded"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"
          />
          <path
            *ngIf="isCustomCodeExpanded"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"
          />
        </svg>
      </button>
      <textarea
        [ngModel]="customJsCode"
        (ngModelChange)="onCodeChange($event)"
        class="w-full p-3 bg-customGray border border-purple-900 rounded text-gray-200 font-mono text-sm focus:outline-none focus:border-orange-500 resize-none"
        [class.h-64]="!isCustomCodeExpanded"
        [class.h-96]="isCustomCodeExpanded"
        placeholder="// Enter custom JavaScript code to execute on TV...&#10;// Example:&#10;const result = Hisense_GetBrand();&#10;console.log(result);&#10;return result;"
      ></textarea>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-3">
    <button
      (click)="onExecute()"
      [disabled]="isExecutingCustomCode || !customJsCode.trim()"
      class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed"
    >
      {{ isExecutingCustomCode ? '‚è≥ Executing...' : '‚ñ∂Ô∏è Execute Custom Code' }}
    </button>
  </div>

  <!-- Result Display -->
  <div *ngIf="customCodeResult !== null" class="mt-4">
    <div class="flex items-center justify-between mb-2">
      <div class="text-sm font-semibold text-orange-400">üìä Result:</div>
      <div class="flex gap-2">
        <button
          (click)="onCopyResult()"
          class="text-xs text-gray-400 hover:text-orange-400 transition-colors px-2 py-1 rounded hover:bg-purple-900/30"
          title="Copy to clipboard"
        >
          üìã Copy
        </button>
      </div>
    </div>
    <div class="relative">
      <button
        *ngIf="shouldShowExpandButton(customCodeResult)"
        (click)="onToggleResultExpansion()"
        class="absolute top-2 right-2 text-gray-400 hover:text-orange-400 transition-colors p-1 bg-customGray-light rounded z-10"
        [title]="
          isCustomCodeResultExpanded ? 'Collapse result' : 'Expand result'
        "
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            *ngIf="!isCustomCodeResultExpanded"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"
          />
          <path
            *ngIf="isCustomCodeResultExpanded"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"
          />
        </svg>
      </button>
      <pre
        class="bg-customGray p-3 rounded border border-purple-900 font-mono text-xs overflow-y-auto text-gray-300"
        [class.max-h-48]="!isCustomCodeResultExpanded"
        [class.max-h-96]="isCustomCodeResultExpanded"
        >{{ formatResult(customCodeResult) }}</pre
      >
    </div>
  </div>

  <!-- Executing Indicator -->
  <div *ngIf="isExecutingCustomCode" class="text-center text-orange-400">
    ‚è≥ Executing custom code on TV...
  </div>

  <!-- Warning -->
  <div
    class="mt-4 p-4 bg-orange-900/20 rounded-lg border-l-4 border-orange-500"
  >
    <div class="flex items-start gap-3">
      <span class="text-orange-400 text-xl">‚ö†Ô∏è</span>
      <div>
        <div class="text-sm font-semibold text-orange-400 mb-1">
          Security Warning
        </div>
        <p class="text-xs text-gray-400">
          Custom code is executed directly on the TV browser. Only run trusted
          code. Malicious code could potentially compromise the TV or network.
        </p>
      </div>
    </div>
  </div>
</div>
